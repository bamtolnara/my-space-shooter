<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í”½ì…€ ìŠˆí„°: ëª¨ë°”ì¼ ì§€ì›</title>
    <style>
        body { margin: 0; background: #111; display: flex; justify-content: center; align-items: center; height: 100vh; color: white; overflow: hidden; touch-action: none; /* ìŠ¤í¬ë¡¤ ë°©ì§€ */ }
        
        /* ìº”ë²„ìŠ¤: ëª¨ë°”ì¼ í™”ë©´ì— ë§ê²Œ ìë™ ì¡°ì ˆ */
        canvas { 
            background: #000; 
            border: 2px solid #444; 
            image-rendering: pixelated; 
            box-shadow: 0 0 20px rgba(0,255,255,0.1);
            max-width: 100%;
            max-height: 80vh; /* í™”ë©´ ë†’ì´ì˜ 80%ë§Œ ì°¨ì§€ */
        }

        #ui { position: absolute; top: 10px; font-size: 20px; font-weight: bold; font-family: 'Courier New', monospace; z-index: 10; text-shadow: 2px 2px 0 #000; pointer-events: none; }
        
        /* ì‹œì‘ í™”ë©´ */
        #start-screen { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.85); 
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            z-index: 100; 
        }
        h1 { font-family: 'Courier New'; font-size: 30px; margin-bottom: 20px; text-shadow: 4px 4px 0 #00e5ff; text-align: center; }
        
        button {
            padding: 15px 30px; font-size: 20px; cursor: pointer; 
            background: #00e5ff; border: none; font-family: 'Courier New', monospace; font-weight: bold;
            box-shadow: 0 0 15px #00e5ff; transition: 0.2s; border-radius: 10px;
        }
        button:active { transform: scale(0.95); background: white; }
        
        #status-msg { margin-top: 20px; color: yellow; font-size: 14px; text-align: center; }

        /* === ğŸ“± ëª¨ë°”ì¼ ì „ìš© ë°œì‚¬ ë²„íŠ¼ === */
        #fireBtnMobile {
            display: none; /* PCì—ì„  ìˆ¨ê¹€ */
            position: absolute;
            bottom: 30px;
            right: 30px;
            width: 80px;
            height: 80px;
            background: rgba(255, 0, 0, 0.5);
            border: 4px solid #ff5252;
            border-radius: 50%;
            color: white;
            font-size: 14px;
            font-weight: bold;
            z-index: 50;
            user-select: none;
            touch-action: manipulation;
        }
        #fireBtnMobile:active { background: rgba(255, 0, 0, 0.8); transform: scale(0.95); }

        /* ëª¨ë°”ì¼ í™˜ê²½ì¼ ë•Œë§Œ ë²„íŠ¼ ë³´ì´ê¸° */
        @media (hover: none) and (pointer: coarse) {
            #fireBtnMobile { display: flex; justify-content: center; align-items: center; }
        }
    </style>
</head>
<body>
    <div id="ui">SCORE: <span id="score">0</span></div>
    
    <div id="start-screen">
        <h1>PIXEL SHOOTER<br><span style="font-size:16px">MOBILE EDITION</span></h1>
        <button id="startBtn">GAME START</button>
        <p style="margin-top: 15px; color: #aaa;">ğŸ’» ë°©í–¥í‚¤ + ìŠ¤í˜ì´ìŠ¤ë°”<br>ğŸ“± í„°ì¹˜ ë“œë˜ê·¸ + ë¹¨ê°„ ë²„íŠ¼</p>
        <p id="status-msg">ì‹œìŠ¤í…œ ë¡œë”©ì¤‘...</p>
    </div>

    <canvas id="gameCanvas" width="400" height="600"></canvas>
    
    <div id="fireBtnMobile">FIRE</div>

    <script>
        window.onload = function() {
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const startBtn = document.getElementById('startBtn');
            const startScreen = document.getElementById('start-screen');
            const statusMsg = document.getElementById('status-msg');
            const fireBtnMobile = document.getElementById('fireBtnMobile');

            statusMsg.innerText = "â— ì¤€ë¹„ ì™„ë£Œ (í„°ì¹˜ ì§€ì›)";
            statusMsg.style.color = "#00ff00";

            startBtn.onclick = function() {
                startScreen.style.display = 'none';
                initAudio();
                gameLoop();
            };

            // === ì˜¤ë””ì˜¤ ì‹œìŠ¤í…œ ===
            let audioCtx;
            function initAudio() {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                audioCtx = new AudioContext();
            }

            function playSound(type) {
                if (!audioCtx) return;
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                const now = audioCtx.currentTime;

                if (type === 'shoot') {
                    osc.type = 'square';
                    osc.frequency.setValueAtTime(800, now);
                    osc.frequency.exponentialRampToValueAtTime(100, now + 0.1);
                    gain.gain.setValueAtTime(0.05, now);
                    gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
                    osc.start(now);
                    osc.stop(now + 0.1);
                } else if (type === 'explosion') {
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(100, now);
                    osc.frequency.exponentialRampToValueAtTime(10, now + 0.3);
                    gain.gain.setValueAtTime(0.1, now);
                    gain.gain.exponentialRampToValueAtTime(0.001, now + 0.3);
                    osc.start(now);
                    osc.stop(now + 0.3);
                } else if (type === 'powerup') {
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(400, now);
                    osc.frequency.linearRampToValueAtTime(1200, now + 0.3);
                    gain.gain.setValueAtTime(0.1, now);
                    gain.gain.exponentialRampToValueAtTime(0.001, now + 0.3);
                    osc.start(now);
                    osc.stop(now + 0.3);
                }
            }

            // === í”½ì…€ ë° ë³€ìˆ˜ ===
            const playerSprite = [[0,0,0,1,0,0,0], [0,0,1,1,1,0,0], [0,1,1,0,1,1,0], [1,1,1,1,1,1,1], [1,0,1,1,1,0,1], [1,0,0,1,0,0,1]];
            const enemySprite = [[1,0,0,0,0,0,1], [0,1,1,1,1,1,0], [1,1,0,1,0,1,1], [1,1,1,1,1,1,1], [0,1,0,0,0,1,0], [0,1,0,0,0,1,0]];
            const itemSprite = [[1,1,1,1,1], [1,0,0,0,1], [1,1,1,1,0], [1,0,0,0,0], [1,0,0,0,0]];

            function drawPixelSprite(sprite, x, y, color, pixelSize) {
                ctx.fillStyle = color;
                for(let r=0; r<sprite.length; r++) {
                    for(let c=0; c<sprite[r].length; c++) {
                        if(sprite[r][c] === 1) ctx.fillRect(x + c*pixelSize, y + r*pixelSize, pixelSize, pixelSize);
                    }
                }
            }

            let score = 0;
            const pixelSize = 5;
            const player = { x: 180, y: 500, width: 35, height: 30, speed: 5, powerLevel: 1 };
            
            let bullets = [];
            let enemies = [];
            let items = [];
            let stars = [];
            let particles = [];
            let keys = {};
            let lastShotTime = 0;
            const SHOT_DELAY = 150; 

            for(let i=0; i<50; i++) stars.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, size: Math.random()*2+1, speed: Math.random()*3+0.5 });

            // === ğŸ® ì»¨íŠ¸ë¡¤ëŸ¬ (í‚¤ë³´ë“œ & í„°ì¹˜) ===
            
            // 1. í‚¤ë³´ë“œ
            window.addEventListener('keydown', (e) => keys[e.code] = true);
            window.addEventListener('keyup', (e) => keys[e.code] = false);

            // 2. ëª¨ë°”ì¼ í„°ì¹˜ ì´ë™
            // í™”ë©´ ì–´ë””ë“  í„°ì¹˜í•˜ê³  ëŒë©´ ë¹„í–‰ê¸°ê°€ ê·¸ ìœ„ì¹˜ë¡œ ë”°ë¼ì˜µë‹ˆë‹¤.
            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault(); // ìŠ¤í¬ë¡¤ ë°©ì§€
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                
                // í„°ì¹˜ ì¢Œí‘œë¥¼ ìº”ë²„ìŠ¤ ì¢Œí‘œë¡œ ë³€í™˜
                const scaleX = canvas.width / rect.width; 
                const scaleY = canvas.height / rect.height;
                
                let touchX = (touch.clientX - rect.left) * scaleX;
                let touchY = (touch.clientY - rect.top) * scaleY;

                // í”Œë ˆì´ì–´ ì´ë™ (ì†ê°€ë½ ì¤‘ì‹¬)
                player.x = touchX - player.width / 2;
                player.y = touchY - player.height / 2;
            }, { passive: false });

            // 3. ëª¨ë°”ì¼ ë°œì‚¬ ë²„íŠ¼
            fireBtnMobile.addEventListener('touchstart', (e) => {
                e.preventDefault();
                keys['Space'] = true; // ìŠ¤í˜ì´ìŠ¤ë°” ëˆ„ë¥¸ ê²ƒì²˜ëŸ¼ ì¸ì‹
            });
            fireBtnMobile.addEventListener('touchend', (e) => {
                e.preventDefault();
                keys['Space'] = false;
            });

            function createExplosion(x, y, color) {
                for(let i=0; i<15; i++) {
                    particles.push({
                        x: x, y: y,
                        dx: (Math.random() - 0.5) * 8,
                        dy: (Math.random() - 0.5) * 8,
                        size: Math.random() * 4 + 2,
                        life: 1.0, color: color
                    });
                }
            }

            function gameLoop() {
                update();
                draw();
                requestAnimationFrame(gameLoop);
            }

            function update() {
                stars.forEach(star => {
                    star.y += star.speed;
                    if (star.y > canvas.height) { star.y = 0; star.x = Math.random()*canvas.width; }
                });

                particles = particles.filter(p => {
                    p.x += p.dx; p.y += p.dy; p.life -= 0.04;
                    return p.life > 0;
                });

                // PCìš© í‚¤ë³´ë“œ ì´ë™
                if (keys['ArrowLeft'] && player.x > 0) player.x -= player.speed;
                if (keys['ArrowRight'] && player.x < canvas.width - player.width) player.x += player.speed;
                if (keys['ArrowUp'] && player.y > 0) player.y -= player.speed;
                if (keys['ArrowDown'] && player.y < canvas.height - player.height) player.y += player.speed;

                // ì´ì•Œ ë°œì‚¬ (ì—°ì‚¬ ì œí•œ)
                if (keys['Space']) {
                    const currentTime = Date.now();
                    if (currentTime - lastShotTime > SHOT_DELAY) {
                        bullets.push({ x: player.x + 15, y: player.y, width: 4, height: 10, dx: 0, isDead: false });
                        if (player.powerLevel >= 2) {
                            bullets.push({ x: player.x + 15, y: player.y, width: 4, height: 10, dx: -4, isDead: false });
                            bullets.push({ x: player.x + 15, y: player.y, width: 4, height: 10, dx: 4, isDead: false });
                        }
                        playSound('shoot');
                        lastShotTime = currentTime;
                    }
                }

                items.forEach(item => {
                    item.y += 2;
                    if (!item.isDead && player.x < item.x + item.width && player.x + player.width > item.x &&
                        player.y < item.y + item.height && player.y + player.height > item.y) {
                        item.isDead = true;
                        player.powerLevel = 2;
                        score += 500;
                        document.getElementById('score').innerText = score;
                        playSound('powerup');
                    }
                    if (item.y > canvas.height) item.isDead = true;
                });
                items = items.filter(item => !item.isDead);

                if (Math.random() < 0.03) {
                    enemies.push({ x: Math.random() * (canvas.width - 35), y: -30, width: 35, height: 30, isDead: false });
                }
                enemies.forEach(e => {
                    e.y += 3;
                    if (e.y > canvas.height) e.isDead = true;
                });

                bullets.forEach(b => {
                    b.y -= 8; b.x += (b.dx || 0);
                    if (b.y < 0 || b.x < 0 || b.x > canvas.width) b.isDead = true;
                });

                // ì¶©ëŒ ê²€ì‚¬
                for (let i = 0; i < bullets.length; i++) {
                    let b = bullets[i];
                    if (b.isDead) continue; 

                    for (let j = 0; j < enemies.length; j++) {
                        let e = enemies[j];
                        if (e.isDead) continue; 

                        if (b.x < e.x + e.width && b.x + b.width > e.x &&
                            b.y < e.y + e.height && b.y + b.height > e.y) {
                            
                            b.isDead = true; 
                            e.isDead = true; 

                            createExplosion(e.x + e.width/2, e.y + e.height/2, '#ff5252');
                            if (Math.random() < 0.1) items.push({ x: e.x, y: e.y, width: 25, height: 25, isDead: false });
                            
                            score += 100;
                            document.getElementById('score').innerText = score;
                            playSound('explosion');

                            break; 
                        }
                    }
                }

                bullets = bullets.filter(b => !b.isDead);
                enemies = enemies.filter(e => !e.isDead);
            }

            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'white';
                stars.forEach(star => ctx.fillRect(star.x, star.y, star.size, star.size));
                
                particles.forEach(p => {
                    ctx.globalAlpha = p.life;
                    ctx.fillStyle = p.color;
                    ctx.fillRect(p.x, p.y, p.size, p.size);
                });
                ctx.globalAlpha = 1.0;

                items.forEach(item => drawPixelSprite(itemSprite, item.x, item.y, '#ffff00', 5));
                drawPixelSprite(playerSprite, player.x, player.y, '#00e5ff', pixelSize);
                enemies.forEach(e => drawPixelSprite(enemySprite, e.x, e.y, '#ff5252', pixelSize));
                ctx.fillStyle = '#ffeb3b';
                bullets.forEach(b => ctx.fillRect(b.x, b.y, b.width, b.height));
            }
            
            draw();
        };
    </script>
</body>
</html>
